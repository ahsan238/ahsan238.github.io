<!-- https://antoinevastel.com/browser%20fingerprinting/2019/03/21/picasso-canvas-fingerprinting.html -->
<!-- https://elie.net/static/files/picasso-lightweight-device-class-fingerprinting-for-web-clients/picasso-lightweight-device-class-fingerprinting-for-web-clients-paper.pdf -->
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">

    <title>Undiscovered Attributes</title>

    <style>
        h1 {
            margin-bottom: 35px;
            margin-top: 10px;
        }

        #canvasgenerated {
            margin-top: 40px;
        }
    </style>
</head>

<body translate="no">
    <pre id="battery"></pre>
    <pre id="browserAttributes"></pre>
    <pre id="audioFP"></pre>
    <pre id="time"></pre>
    <!-- <canvas id="myCanvas"></canvas> -->

    <div style="text-align:left;" id="canvasgenerated"></div>

    <script src="fp_scanner.js"></script>
    <script src="canvas.js"></script>
    <script src="audio.js"></script>

    

    <!-- browser attribute fingerprinting  -->
    <script>

        async function prepareAndGo() {
            const res = generateFingerprint()
            display_fp()
        }

        async function display_fp(fp) {
            // battery status may not be an option on Safari
            if (typeof navigator.getBattery === 'function') {
                navigator.getBattery().then(function (battery) {
                    document.getElementById("battery").innerText = "battery level: " + battery.level
                })
                    .catch((e) => {
                        console.log(e)
                    })
            }


            generateFingerprint().then((fp) => {
                resultString = ""
                for (var key in fp) {
                    if (fp[key] !== undefined) {
                        resultString += key + ": " + fp[key].toString() + '\n';
                    } else {
                        resultString += key + ": " + "UNDEFINED" + '\n';
                    }
                }
                document.getElementById("browserAttributes").innerText = resultString
            })
        }

        window.onload = prepareAndGo;

    </script>

    <!-- canvas fingerprinting -->
    <script>
        const params = {
            area: {
                width: 300,
                height: 300,
            },
            offsetParameter: 2001000001,
            fontSizeFactor: 1.5,
            multiplier: 15000,
            maxShadowBlur: 50,
        };
        const numShapes = 5;
        // const initialSeed = Math.floor(100 * Math.random());
        const initialSeed = 42;

        const start = performance.now();

        const canvasValue = picassoCanvas(
            numShapes, initialSeed, params
        );

        const end = performance.now();
        // console.log(canvasValue)
        if (canvasValue.indexOf('base64') > -1) {
            const img = document.createElement('img');
            img.src = canvasValue;
            // document.getElementById('canvasgenerated').innerHTML = `<p>Canvas with ${numShapes} primitives computed in ${((end - start) / 1000).toFixed(6)} seconds</p>`;
            document.getElementById('canvasgenerated').innerHTML = `<p>Canvas with ${numShapes} primitives, generated in ${((end - start)/1000).toFixed(6)} seconds</p><p>Hash: ${x64hash128(canvasValue, initialSeed)}</p>`;
            document.getElementById('canvasgenerated').appendChild(img);
        } else {
            document.getElementById('canvasgenerated').innerHTML = '<h2 class="alert alert-danger">An error occured</h2>';
        }
    </script>

    <!-- Audio FP -->
    <script>
        const audio_fp = audioFp()
        
    </script>


</body>

</html>